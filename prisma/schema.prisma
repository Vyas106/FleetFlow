generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  MANAGER
  DISPATCHER
  SAFETY_OFFICER
  FINANCIAL_ANALYST
}

enum VehicleType {
  TRUCK
  VAN
  BIKE
  MINI
  TRAILER
}

enum VehicleStatus {
  AVAILABLE
  ON_TRIP
  IN_SHOP
  OUT_OF_SERVICE
}

enum DriverStatus {
  ON_DUTY
  OFF_DUTY
  SUSPENDED
}

enum TripStatus {
  DRAFT
  DISPATCHED
  COMPLETED
  CANCELLED
}

enum ServiceStatus {
  NEW
  IN_PROGRESS
  RESOLVED
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  passwordHash String
  role         Role     @default(MANAGER)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Vehicle {
  id              String        @id @default(cuid())
  name            String
  model           String
  type            VehicleType
  licensePlate    String        @unique
  maxLoadCapacity Float
  odometer        Int           @default(0)
  status          VehicleStatus @default(AVAILABLE)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  trips       Trip[]
  serviceLogs ServiceLog[]
  expenseLogs ExpenseLog[]
}

model Driver {
  id             String       @id @default(cuid())
  name           String
  licenseNumber  String       @unique
  licenseExpiry  DateTime
  status         DriverStatus @default(ON_DUTY)
  safetyScore    Float        @default(100.0)
  completionRate Float        @default(100.0)
  complaints     Int          @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  trips       Trip[]
  expenseLogs ExpenseLog[]
}

model Trip {
  id            String     @id @default(cuid())
  origin        String
  destination   String
  cargoWeight   Float
  estFuelCost   Float
  status        TripStatus @default(DRAFT)
  distance      Float?
  revenue       Float?
  finalOdometer Int?
  completedAt   DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt

  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
  driverId  String
  driver    Driver  @relation(fields: [driverId], references: [id])

  expenseLogs ExpenseLog[]
}

model ServiceLog {
  id        String        @id @default(cuid())
  issue     String
  cost      Float
  date      DateTime      @default(now())
  status    ServiceStatus @default(NEW)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
}

model ExpenseLog {
  id          String   @id @default(cuid())
  fuelCost    Float    @default(0)
  miscExpense Float    @default(0)
  liters      Float    @default(0)
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id])
  driverId  String
  driver    Driver  @relation(fields: [driverId], references: [id])
  tripId    String?
  trip      Trip?   @relation(fields: [tripId], references: [id])
}
